{% extends "base.html" %}

{% block content %}
<div style="
    background: linear-gradient(135deg, #4a6cf7, #6a82fb);
    color: white;
    padding: 40px;
    border-radius: 12px;
    margin-bottom: 30px;
    text-align: center;
">
    <h1 style="margin-bottom: 10px;">ðŸ“š BookShare AI</h1>
    <p style="font-size: 18px;">
        A community-driven platform to share, discover, and AI-summarise books.
    </p>
</div>
<h1>Community Book Sharing</h1>

<a href="/upload/" class="btn btn-primary mt-3">Upload Book</a>


<!-- ðŸ”¹ Live recommendation results -->
<div id="live-results" class="row mt-3"></div>

<hr>

<!-- ðŸ”¹ ORIGINAL BOOK LIST (UNCHANGED) -->
<div class="row mt-4" id="all-books">
    {% for book in books %}


    <div class="col-md-4">
        <div class="card p-3 mb-3">
            <h4>{{ book.title }}</h4>
            <p>by {{ book.author }}</p>
            <a href="/book/{{ book.id }}/" class="btn btn-primary">
                View Details
            </a>
        </div>
    </div>
    {% endfor %}
</div>

{% if books|length == 0 %}
<p>No books yet. Be the first to upload!</p>
{% endif %}

<!-- ðŸ”¹ JavaScript for LIVE recommendations -->
<script>
const input = document.getElementById("live-search");
const resultsDiv = document.getElementById("live-results");
const allBooksDiv = document.getElementById("all-books");

input.addEventListener("keyup", function () {
    const query = this.value.trim();

    // If empty â†’ show original list again
    if (query.length === 0) {
        resultsDiv.innerHTML = "";
        allBooksDiv.style.display = "flex";
        return;
    }

    fetch(/ajax/search/?q=${query})
        .then(response => response.json())
        .then(data => {
            resultsDiv.innerHTML = "";
            allBooksDiv.style.display = "none";

            if (data.results.length === 0) {
                resultsDiv.innerHTML = "<p>No recommendations found</p>";
                return;
            }

            data.results.forEach(book => {
                resultsDiv.innerHTML += `
                    <div class="col-md-4">
                        <div class="card p-3 mb-3">
                            <h4>${book.title}</h4>
                            <p>by ${book.author}</p>
                            <a href="/book/${book.id}/" class="btn btn-primary">
                                View Details
                            </a>
                        </div>
                    </div>
                `;
            });
        });
});
</script>
<p style="
    text-align: center;
    margin-top: 40px;
    color: #888;
    font-size: 14px;
">
    Â© 2025 BookShare AI | Powered by Django & Hugging Face. Developed by Nabaraj Timilsina
</p>
{% endblock %}
